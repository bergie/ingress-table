topic: "ingress-table/CalculateState"
name: "Portal state calculation"
fixture:
 type: 'fbp'
 data: |
  # @runtime noflo

  INPORT=c.STATE:IN
  INPORT=g.KEY:KEY
  OUTPORT=g.OUT:OUT

  c(ingress-table/CalculateState) STATE -> IN g(objects/GetObjectKey)

cases:
-
  name: 'receiving a stable L4 portal'
  assertion: 'should set state as stable'
  inputs:
    key: 'state'
    in:
      title: 'c-base space station'
      guid: 'a6301120831b46f1be00fa2cb0bce195.16'
      health: 100
      level: 4
      team: 'RESISTANCE'
  expect:
    out:
      equals: 'stable'
-
  name: 'receiving a L8 RES portal'
  assertion: 'should set state as awesome'
  inputs:
    key: 'state'
    in:
      title: 'c-base space station'
      guid: 'a6301120831b46f1be00fa2cb0bce195.16'
      health: 100
      level: 8
      team: 'RESISTANCE'
  expect:
    out:
      equals: 'awesome'
-
  name: 'receiving a L8 ENL portal'
  assertion: 'should set state as bad'
  inputs:
    key: 'state'
    in:
      title: 'c-base space station'
      guid: 'a6301120831b46f1be00fa2cb0bce195.16'
      health: 100
      level: 8
      team: 'ALIENS'
  expect:
    out:
      equals: 'bad'
-
  name: 'receiving a L8 NEUTRAL portal'
  assertion: 'should set state as bad'
  inputs:
    key: 'state'
    in:
      title: 'c-base space station'
      guid: 'a6301120831b46f1be00fa2cb0bce195.16'
      health: 100
      level: 8
      team: 'NEUTRAL'
  expect:
    out:
      equals: 'disco'